<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="report_invoice_document_extend" inherit_id="account.report_invoice_document">
        
        <!-- Eliminar el bloque de direcciones -->
        <xpath expr="//div[@name='shipping_address_block']/ancestor::div[contains(@class, 'row')]" position="replace">
            <t/>
        </xpath>

        <!-- Eliminar el bloque de código del cliente -->
        <xpath expr="//div[@name='customer_code']" position="replace"/>

        <!-- Insertar los datos de la sociedad y el cliente en formato de dos columnas -->
        <xpath expr="//div[@id='informations']" position="before">
            <div class="mt-0 mb-0 two-column-container">
                <!-- Datos de la Sociedad -->
                <div class="compact-card first-column">
                    <div class="compact-header">Datos de la Sociedad</div>
                    <div class="compact-body">
                        <div class="compact-row"><strong>Nombre:</strong> <span t-esc="o.company_id.partner_id.name"/></div>
                        <div class="compact-row"><strong>Dirección:</strong> <span t-esc="o.company_id.partner_id.street"/></div>
                        <t t-if="o.company_id.partner_id.vat">
                            <div class="compact-row"><strong>NIT:</strong> <span t-esc="o.company_id.partner_id.vat"/></div>
                        </t>
                        <t t-if="o.company_id.partner_id.commercial_registration_number">
                            <div class="compact-row"><strong>IRCC:</strong> <span t-esc="o.company_id.partner_id.commercial_registration_number"/></div>
                        </t>
                        <t t-if="o.company_id.partner_id.bank_accounts">
                            <div class="compact-row"><strong>Cuenta Bancaria:</strong> <t t-esc="o.company_id.partner_id.bank_accounts.split('; ')[0] or 'No especificado'"/></div>
                        </t>                           
                    </div>
                </div>

                <!-- Datos del Cliente -->
                <div class="compact-card second-column">
                    <div class="compact-header">Datos del Cliente</div>
                    <div class="compact-body">
                        <div class="compact-row"><strong>Nombre:</strong> <span t-esc="o.partner_id.name"/></div>
                        <div class="compact-row">
                            <strong>Dirección:</strong> 
                            <span>
                                <t t-esc="o.partner_id.street"/>
                                <t t-if="o.partner_id.state_id">, <t t-esc="o.partner_id.state_id.name"/></t>
                            </span>
                        </div>
                        <t t-if="o.partner_id.vat">
                            <div class="compact-row"><strong>NIT:</strong> <span t-esc="o.partner_id.vat"/></div>
                        </t>
                        <t t-if="o.partner_id.ref">
                            <div class="compact-row"><strong>Código:</strong> <span t-esc="o.partner_id.ref"/></div>
                        </t>
                        <t t-if="o.partner_id.bank_accounts">
                            <div class="compact-row"><strong>Cuenta Bancaria:</strong> <span t-esc="o.partner_id.bank_accounts"/></div>
                        </t>
                        <t t-if="o.partner_id.asi_contract">
                            <div class="compact-row"><strong>Contrato:</strong> <span t-esc="o.partner_id.asi_contract"/></div>
                        </t>
                    </div>
                </div>
            </div>  
        </xpath>

        <!-- Estilos optimizados para ambos formatos -->
        <xpath expr="//div[hasclass('page')]" position="inside">
            <style>
                .page { 
                    font-size: 11pt;
                }
                
                /* Contenedor principal */
                .two-column-container {
                    width: 100%;
                    overflow: hidden; /* Clearfix para floats */
                }
                
                /* Columnas para vista HTML */
                .first-column, .second-column {
                    width: 48%;
                    box-sizing: border-box;
                }
                
                .first-column {
                    float: left;
                }
                
                .second-column {
                    float: right;
                }
                
                /* Estilos para PDF */
                @media print {
                    .first-column, .second-column {
                        width: 100%;
                        float: none;
                        margin-bottom: 10px;
                    }
                }
                
                /* Estilos comunes */
                .compact-card {
                    border: 1px solid #e0e0e0;
                    border-radius: 3px;
                    margin-bottom: 5px;
                    page-break-inside: avoid;
                }
                
                .compact-header {
                    background-color: #f5f5f5;
                    padding: 5px 8px;
                    font-weight: bold;
                    font-size: 13px;
                    border-bottom: 1px solid #e0e0e0;
                }
                
                .compact-body {
                    padding: 8px;
                }
                
                .compact-row {
                    display: flex;
                    margin-bottom: 3px;
                    line-height: 1.3;
                }
                
                .compact-row strong {
                    min-width: 40%;
                    font-weight: 500;
                }
                
                .compact-row span {
                    flex-grow: 1;
                }
            </style>
        </xpath>

        <!-- Modificar la forma de pago -->
        <xpath expr="//p[@name='payment_communication']" position="replace">
            <p style="margin: 5px 0; line-height: 1.3; font-size: 11pt;">
                <strong>Forma de Pago:</strong> <t t-esc="'Cheque o Transferencia'"/>.
                <strong>Plazo:</strong> <t t-esc="o.invoice_payment_term_id.name or 'No especificado'"/>.
                <strong>Páguese a cuenta bancaria:</strong> <t t-esc="o.company_id.partner_id.bank_accounts.split('; ')[0] or 'No especificado'"/>.
                <strong>Importe en letras:</strong> <t t-esc="o.amount_in_words or 'No especificado'"/>.
             </p>
        </xpath>
    </template>
</odoo>