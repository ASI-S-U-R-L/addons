<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Plantilla para solicitud de aprobación - CORREGIDA -->
        <record id="email_template_fuel_plan_approval" model="mail.template">
            <field name="name">Plantilla de Aprobación de Plan de Combustible</field>
            <field name="model_id" ref="model_fuel_plan"/>
            <field name="subject">Solicitud de Aprobación: Plan de Combustible ${object.name}</field>
            <field name="email_from">${(object.create_uid.email_formatted or user.email_formatted) | safe}</field>
            <field name="email_to">${(object.director_id.email_formatted) | safe}</field>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        Estimado/a <strong>${object.director_id.name}</strong>,
                        <br/><br/>
                        Se ha creado una nueva propuesta de plan de combustible que requiere su aprobación.
                        <br/><br/>
                        <strong>Referencia:</strong> ${object.name}<br/>
                        <strong>Fecha:</strong> ${format_date(object.date)}<br/>
                        <strong>Combustible Facturado:</strong> ${object.invoiced_fuel} litros<br/>
                        <br/>
                        <strong>Distribución:</strong><br/>
                        <table style="width:100%; border-collapse: collapse;">
                            <tr style="background-color: #f2f2f2;">
                                <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Tarjeta</th>
                                <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Importe</th>
                            </tr>
                            % for line in object.distribution_ids:
                            <tr>
                                <td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${line.card_id.name}</td>
                                <td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${line.amount}</td>
                            </tr>
                            % endfor
                        </table>
                        <br/>
                        <p>
                            <strong>Instrucciones:</strong><br/>
                            1. Puede revisar y modificar la distribución del combustible entre las tarjetas.<br/>
                            2. Utilice el botón "Guardar Cambios" para guardar sus modificaciones.<br/>
                            3. Una vez satisfecho con la distribución, utilice el botón "Aprobar" para aprobar el plan.<br/>
                            4. Si no está de acuerdo con el plan, puede rechazarlo o añadir comentarios.
                        </p>
                        <br/>
                        % if object.id and object.id != 0:
                        Puede revisar y aprobar esta propuesta haciendo clic en el siguiente enlace:
                        <br/>
                        <a href="/web#model=fuel.plan&amp;id=${object.id}&amp;view_type=form&amp;action=${ref('fuel_card_management.action_fuel_plan')}" style="background-color: #875A7B; padding: 8px 16px 8px 16px; text-decoration: none; color: #fff; border-radius: 5px; font-size:13px;">
                            Ver Propuesta
                        </a>
                        % else:
                        <p style="color: #856404; background-color: #fff3cd; padding: 10px; border-radius: 5px;">
                            <strong>Nota:</strong> Acceda al sistema para revisar la propuesta de plan de combustible <strong>${object.name}</strong>.
                        </p>
                        % endif
                        <br/><br/>
                        Saludos cordiales,
                        <br/>
                        ${object.create_uid.name}
                    </p>
                </div>
            </field>
            <field name="lang">${object.director_id.lang}</field>
            <field name="auto_delete" eval="True"/>
        </record>

        <!-- Plantilla para plan modificado - CORREGIDA -->
        <record id="email_template_fuel_plan_modified" model="mail.template">
            <field name="name">Plantilla de Plan de Combustible Modificado</field>
            <field name="model_id" ref="model_fuel_plan"/>
            <field name="subject">Plan de Combustible Modificado: ${object.name}</field>
            <field name="email_from">${(object.director_id.email_formatted or user.email_formatted) | safe}</field>
            <field name="email_to">${(object.create_uid.email_formatted) | safe}</field>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        Estimado/a <strong>${object.create_uid.name}</strong>,
                        <br/><br/>
                        El director <strong>${object.director_id.name}</strong> ha realizado modificaciones en su propuesta de plan de combustible.
                        <br/><br/>
                        <strong>Referencia:</strong> ${object.name}<br/>
                        <strong>Fecha:</strong> ${format_date(object.date)}<br/>
                        <strong>Combustible Facturado:</strong> ${object.invoiced_fuel} litros<br/>
                        <br/>
                        <strong>Distribución Modificada:</strong><br/>
                        <table style="width:100%; border-collapse: collapse;">
                            <tr style="background-color: #f2f2f2;">
                                <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Tarjeta</th>
                                <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Importe</th>
                            </tr>
                            % for line in object.distribution_ids:
                            <tr>
                                <td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${line.card_id.name}</td>
                                <td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${line.amount}</td>
                            </tr>
                            % endfor
                        </table>
                        <br/>
                        % if object.director_comments:
                        <strong>Comentarios del Director:</strong><br/>
                        ${object.director_comments | safe}
                        <br/><br/>
                        % endif
                        % if object.id and object.id != 0:
                        Puede revisar las modificaciones haciendo clic en el siguiente enlace:
                        <br/>
                        <a href="/web#model=fuel.plan&amp;id=${object.id}&amp;view_type=form&amp;action=${ref('fuel_card_management.action_fuel_plan')}" style="background-color: #875A7B; padding: 8px 16px 8px 16px; text-decoration: none; color: #fff; border-radius: 5px; font-size:13px;">
                            Ver Plan Modificado
                        </a>
                        % else:
                        <p style="color: #856404; background-color: #fff3cd; padding: 10px; border-radius: 5px;">
                            <strong>Nota:</strong> Acceda al sistema para revisar el plan modificado <strong>${object.name}</strong>.
                        </p>
                        % endif
                        <br/><br/>
                        Saludos cordiales,
                        <br/>
                        ${object.director_id.name}
                    </p>
                </div>
            </field>
            <field name="lang">${object.create_uid.lang}</field>
            <field name="auto_delete" eval="True"/>
        </record>

        <!-- Plantilla para plan aprobado - CORREGIDA -->
        <record id="email_template_fuel_plan_approved" model="mail.template">
            <field name="name">Plantilla de Plan de Combustible Aprobado</field>
            <field name="model_id" ref="model_fuel_plan"/>
            <field name="subject">Plan de Combustible Aprobado: ${object.name}</field>
            <field name="email_from">${(object.director_id.email_formatted or user.email_formatted) | safe}</field>
            <field name="email_to">${(object.create_uid.email_formatted) | safe}</field>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        Estimado/a <strong>${object.create_uid.name}</strong>,
                        <br/><br/>
                        Su propuesta de plan de combustible ha sido <strong style="color: green;">APROBADA</strong> por el director <strong>${object.director_id.name}</strong>.
                        <br/><br/>
                        <strong>Referencia:</strong> ${object.name}<br/>
                        <strong>Fecha:</strong> ${format_date(object.date)}<br/>
                        <strong>Combustible Facturado:</strong> ${object.invoiced_fuel} litros<br/>
                        <br/>
                        % if object.modified_by_director:
                        <p style="color: #856404; background-color: #fff3cd; padding: 10px; border-radius: 5px;">
                            <strong>Nota:</strong> El plan fue modificado por el director antes de ser aprobado.
                        </p>
                        % endif
                        <strong>Distribución Aprobada:</strong><br/>
                        <table style="width:100%; border-collapse: collapse;">
                            <tr style="background-color: #f2f2f2;">
                                <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Tarjeta</th>
                                <th style="border: 1px solid #dddddd; text-align: left; padding: 8px;">Importe</th>
                            </tr>
                            % for line in object.distribution_ids:
                            <tr>
                                <td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${line.card_id.name}</td>
                                <td style="border: 1px solid #dddddd; text-align: left; padding: 8px;">${line.amount}</td>
                            </tr>
                            % endfor
                        </table>
                        <br/>
                        % if object.director_comments:
                        <strong>Comentarios del Director:</strong><br/>
                        ${object.director_comments | safe}
                        <br/><br/>
                        % endif
                        <p>
                            <strong>Acciones realizadas:</strong><br/>
                            - Se han creado automáticamente las cargas de tarjetas según la distribución aprobada.<br/>
                            - Los saldos de las tarjetas han sido actualizadas.
                        </p>
                        <br/>
                        % if object.id and object.id != 0:
                        Puede revisar el plan aprobado haciendo clic en el siguiente enlace:
                        <br/>
                        <a href="/web#model=fuel.plan&amp;id=${object.id}&amp;view_type=form&amp;action=${ref('fuel_card_management.action_fuel_plan')}" style="background-color: #28a745; padding: 8px 16px 8px 16px; text-decoration: none; color: #fff; border-radius: 5px; font-size:13px;">
                            Ver Plan Aprobado
                        </a>
                        % else:
                        <p style="color: #856404; background-color: #fff3cd; padding: 10px; border-radius: 5px;">
                            <strong>Nota:</strong> Acceda al sistema para revisar el plan aprobado <strong>${object.name}</strong>.
                        </p>
                        % endif
                        <br/><br/>
                        Saludos cordiales,
                        <br/>
                        ${object.director_id.name}
                    </p>
                </div>
            </field>
            <field name="lang">${object.create_uid.lang}</field>
            <field name="auto_delete" eval="True"/>
        </record>

        <!-- Plantilla para plan rechazado - CORREGIDA -->
        <record id="email_template_fuel_plan_rejected" model="mail.template">
            <field name="name">Plantilla de Plan de Combustible Rechazado</field>
            <field name="model_id" ref="model_fuel_plan"/>
            <field name="subject">Plan de Combustible Rechazado: ${object.name}</field>
            <field name="email_from">${(object.director_id.email_formatted or user.email_formatted) | safe}</field>
            <field name="email_to">${(object.create_uid.email_formatted) | safe}</field>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        Estimado/a <strong>${object.create_uid.name}</strong>,
                        <br/><br/>
                        Su propuesta de plan de combustible ha sido <strong style="color: red;">RECHAZADA</strong> por el director <strong>${object.director_id.name}</strong>.
                        <br/><br/>
                        <strong>Referencia:</strong> ${object.name}<br/>
                        <strong>Fecha:</strong> ${format_date(object.date)}<br/>
                        <strong>Combustible Facturado:</strong> ${object.invoiced_fuel} litros<br/>
                        <br/>
                        % if object.director_comments:
                        <strong>Motivo del rechazo:</strong><br/>
                        ${object.director_comments | safe}
                        <br/><br/>
                        % endif
                        <p>
                            Puede revisar el plan rechazado y realizar las modificaciones necesarias para volver a enviarlo para aprobación.
                        </p>
                        <br/>
                        % if object.id and object.id != 0:
                        <a href="/web#model=fuel.plan&amp;id=${object.id}&amp;view_type=form&amp;action=${ref('fuel_card_management.action_fuel_plan')}" style="background-color: #dc3545; padding: 8px 16px 8px 16px; text-decoration: none; color: #fff; border-radius: 5px; font-size:13px;">
                            Ver Plan Rechazado
                        </a>
                        % else:
                        <p style="color: #856404; background-color: #fff3cd; padding: 10px; border-radius: 5px;">
                            <strong>Nota:</strong> Acceda al sistema para revisar el plan rechazado <strong>${object.name}</strong>.
                        </p>
                        % endif
                        <br/><br/>
                        Saludos cordiales,
                        <br/>
                        ${object.director_id.name}
                    </p>
                </div>
            </field>
            <field name="lang">${object.create_uid.lang}</field>
            <field name="auto_delete" eval="True"/>
        </record>
    </data>
</odoo>
