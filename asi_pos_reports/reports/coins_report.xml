<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Template del reporte PDF -->
    <template id="report_pos_coins_document">
        <t t-call="web.html_container">
            <t t-call="asi_pos_reports.report_blank_layout">
                <div class="page" style="font-size: 11pt;">
                    <t t-foreach="docs" t-as="doc">
                        <t t-set="data" t-value="doc._get_coins_data()" />

                        <div style="text-align: center; margin-bottom: 20px;">
                            <h3 style="margin: 0 0 10px 0; font-weight: 600;">Monedas</h3>
                        </div>

                        <hr style="margin: 10px 0; border-top: 1px solid #ddd;" />

                        <div style="margin-bottom: 15px; font-size: 10pt;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 30%;">
                                        <strong>Fecha:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['date']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Usuario:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['user_name']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Sesión:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['session_name']" />
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <hr style="margin: 10px 0; border-top: 1px solid #ddd;" />

                        <div style="margin-bottom: 15px; font-size: 10pt;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 30%;">
                                        <strong>Empresa:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['empresa_name']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Entidad:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['company_name']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Dirección:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['company_address']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Teléfono:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['company_phone']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Desde:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['start_date']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Hasta:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['end_date']" />
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <hr style="margin: 10px 0; border-top: 1px solid #ddd;" />

                        <!-- Simplificado: solo mostrar el importe de apertura sin desglose de
                        monedas -->
                        <div style="margin-bottom: 15px; font-size: 10pt;">
                            <div style="font-weight: 600; margin-bottom: 5px;">Inicial</div>
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 30%;">
                                        <strong>CUP Importe:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['opening_balance']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <hr style="margin: 10px 0; border-top: 1px solid #ddd;" />

                        <!-- Simplificado: solo mostrar el importe de retiro sin desglose de monedas -->
                        <div style="margin-bottom: 15px; font-size: 10pt;">
                            <div style="font-weight: 600; margin-bottom: 5px;">Retiro</div>
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 30%;">
                                        <strong>CUP Importe:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['withdrawal']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <hr style="margin: 10px 0; border-top: 1px solid #ddd;" />

                        <!-- Simplificado: solo mostrar el importe de apertura sin desglose de
                        monedas -->
                        <div style="margin-bottom: 15px; font-size: 10pt;">
                            <div style="font-weight: 600; margin-bottom: 5px;">Final</div>
                            <table style="width: 100%;">
                                <tr>
                                    <td style="width: 30%;">
                                        <strong>CUP Importe:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="data['ending_cash']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </t>
                </div>
            </t>
        </t>
    </template>

    <!-- Reporte PDF de Monedas -->
    <record id="action_report_pos_coins" model="ir.actions.report">
        <field name="name">Reporte de Monedas</field>
        <field name="model">pos.session</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">asi_pos_reports.report_pos_coins_document</field>
        <field name="report_file">asi_pos_reports.report_pos_coins_document</field>
        <field name="binding_model_id" ref="point_of_sale.model_pos_session" />
        <field name="binding_type">report</field>
    </record>

    <!-- Template para previsualización de ticket con formato de tirilla térmica -->
    <template id="report_pos_coins_ticket_preview">
        <t t-call="web.html_container">
            <t t-call="asi_pos_reports.report_blank_layout">
                <div class="page">
                    <t t-foreach="docs" t-as="doc">
                        <t t-set="data" t-value="doc._get_coins_data()" />

                        <div
                            style="max-width: 200px; margin: 0 auto; font-family: 'Oswald', sans-serif; border: 2px dashed #ccc; padding: 10px; background-color: #f9f9f9; font-size: 10px; line-height: 1.3;">
                            <style>
                                @import
                                url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;600&amp;display=swap');
                            </style>

                            <div
                                style="text-align: center; font-size: 12px; font-weight: 600; margin-bottom: 5px;">
                                MONEDAS
                            </div>
                            <div style="text-align: center; margin: 3px 0;">
                                ============================</div>

                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell; word-wrap: break-word;">Fecha:</div>
                                <div style="display: table-cell; text-align: right;">
                                    <t t-esc="data['date']" />
                                </div>
                            </div>
                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell; word-wrap: break-word;">Usuario:</div>
                                <div style="display: table-cell; text-align: right;">
                                    <t t-esc="data['user_name']" />
                                </div>
                            </div>
                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell; word-wrap: break-word;">Sesion:</div>
                                <div style="display: table-cell; text-align: right;">
                                    <t t-esc="data['session_name']" />
                                </div>
                            </div>
                            <div style="text-align: center; margin: 3px 0;">
                                ============================</div>

                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell; word-wrap: break-word;">Empresa:</div>
                                <div style="display: table-cell; text-align: right;">
                                    <t t-esc="data['empresa_name']" />
                                </div>
                            </div>
                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell; word-wrap: break-word;">Entidad:</div>
                                <div style="display: table-cell; text-align: right;">
                                    <t t-esc="data['company_name']" />
                                </div>
                            </div>
                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell; word-wrap: break-word;">Direccion:</div>
                                <div style="display: table-cell; text-align: right;">
                                    <t t-esc="data['company_address']" />
                                </div>
                            </div>
                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell; word-wrap: break-word;">Telefono:</div>
                                <div style="display: table-cell; text-align: right;">
                                    <t t-esc="data['company_phone']" />
                                </div>
                            </div>
                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell; word-wrap: break-word;">Desde:</div>
                                <div style="display: table-cell; text-align: right;">
                                    <t t-esc="data['start_date']" />
                                </div>
                            </div>
                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell; word-wrap: break-word;">Hasta:</div>
                                <div style="display: table-cell; text-align: right;">
                                    <t t-esc="data['end_date']" />
                                </div>
                            </div>
                            <div style="text-align: center; margin: 3px 0;">
                                ============================</div>

                            <div style="font-weight: 600; margin: 3px 0;">Inicial</div>
                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell;">CUP Importe:</div>
                                <div style="display: table-cell; text-align: right;"> $<t
                                        t-esc="'{:,.2f}'.format(data['opening_balance'])" />
                                </div>
                            </div>
                            <div style="text-align: center; margin: 3px 0;">
                                ============================</div>

                            <div style="font-weight: 600; margin: 3px 0;">Retiro</div>
                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell;">CUP Importe:</div>
                                <div style="display: table-cell; text-align: right;"> $<t
                                        t-esc="'{:,.2f}'.format(data['withdrawal'])" />
                                </div>
                            </div>
                            <div style="text-align: center; margin: 3px 0;">
                                ============================</div>

                            <div style="font-weight: 600; margin: 3px 0;">Final</div>
                            <div style="display: table; width: 100%; margin: 2px 0;">
                                <div style="display: table-cell;">CUP Importe:</div>
                                <div style="display: table-cell; text-align: right;"> $<t
                                        t-esc="'{:,.2f}'.format(data['ending_cash'])" />
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </t>
        </t>
    </template>

    <!-- Reporte para previsualización de ticket -->
    <record id="action_report_pos_coins_ticket_preview" model="ir.actions.report">
        <field name="name">Previsualización Ticket - Monedas</field>
        <field name="model">pos.session</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">asi_pos_reports.report_pos_coins_ticket_preview</field>
        <field name="report_file">asi_pos_reports.report_pos_coins_ticket_preview</field>
        <field name="binding_model_id" ref="point_of_sale.model_pos_session" />
        <field name="binding_type">report</field>
    </record>

    <!-- Template para ticket de impresora con formato mejorado -->
    <template id="report_pos_coins_ticket_document">
        <t t-call="web.basic_layout">
            <div
                style="font-family: Arial, sans-serif; font-size: 10px; width: 190px; max-width: 190px; margin: 0; padding: 1px; line-height: 1.2;">
                <!-- Encabezado -->
                <div style="text-align: left; margin-bottom: 5px;">
                    <strong style="font-size: 12px;">MONEDAS</strong>
                </div>

                <!-- Información de la sesión -->
                <t t-foreach="docs" t-as="doc">
                    <t t-set="data" t-value="doc._get_coins_data()" />

                    <div style="text-align: left;">
                        <div style="margin: 1px 0;">FECHA: <t t-esc="data['date']" /></div>
                        <div style="margin: 1px 0;">USUARIO: <t t-esc="data['user_name']" /></div>
                        <div style="margin: 1px 0;">SESIÓN: <t t-esc="data['session_name']" /></div>
                        <div style="margin: 1px 0;">EMPRESA: <t t-esc="data['empresa_name']" /></div>
                        <div style="margin: 1px 0;">ENTIDAD: <t t-esc="data['company_name']" /></div>
                        <div style="margin: 1px 0;">DESDE: <t t-esc="data['start_date']" /></div>
                        <div style="margin: 1px 0;">HASTA: <t t-esc="data['end_date']" /></div>
                    </div>
                </t>

                <div style="margin: 3px 0;">--------------------------------</div>

                <!-- Inicial -->
                <div style="font-weight: bold; margin: 3px 0;">INICIAL</div>
                <table style="width: 100%; border-collapse: collapse; margin: 1px 0;">
                    <tr>
                        <td style="text-align: left; padding: 0;">CUP Importe</td>
                        <td style="text-align: right; white-space: nowrap; padding: 0; width: 70px;">
                            $<t t-esc="'{:,.2f}'.format(data['opening_balance'])" />
                        </td>
                    </tr>
                </table>

                <div style="margin: 3px 0;">--------------------------------</div>

                <!-- Retiro -->
                <div style="font-weight: bold; margin: 3px 0;">RETIRO</div>
                <table style="width: 100%; border-collapse: collapse; margin: 1px 0;">
                    <tr>
                        <td style="text-align: left; padding: 0;">CUP Importe</td>
                        <td style="text-align: right; white-space: nowrap; padding: 0; width: 70px;">
                            $<t t-esc="'{:,.2f}'.format(data['withdrawal'])" />
                        </td>
                    </tr>
                </table>

                <div style="margin: 3px 0;">--------------------------------</div>

                <!-- Final -->
                <div style="font-weight: bold; margin: 3px 0;">FINAL</div>
                <table style="width: 100%; border-collapse: collapse; margin: 1px 0;">
                    <tr>
                        <td style="text-align: left; padding: 0;">CUP Importe</td>
                        <td style="text-align: right; white-space: nowrap; padding: 0; width: 70px;">
                            $<t t-esc="'{:,.2f}'.format(data['ending_cash'])" />
                        </td>
                    </tr>
                </table>

                <div style="margin: 3px 0;">--------------------------------</div>

            </div>
        </t>
    </template>

    <!-- Reporte Ticket de Monedas para impresora -->
    <record id="action_report_pos_coins_ticket" model="ir.actions.report">
        <field name="name">Ticket de Monedas</field>
        <field name="model">pos.session</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">asi_pos_reports.report_pos_coins_ticket_document</field>
        <field name="report_file">asi_pos_reports.report_pos_coins_ticket_document</field>
        <field name="binding_model_id" ref="point_of_sale.model_pos_session" />
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="asi_pos_reports.paperformat_thermal_ticket" />
    </record>
</odoo>