<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Definición del reporte PDF principal -->
    <record id="action_report_shift_balance" model="ir.actions.report">
        <field name="name">Balance de Turno</field>
        <field name="model">pos.session</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">asi_pos_reports.report_shift_balance_document</field>
        <field name="report_file">asi_pos_reports.report_shift_balance_document</field>
        <field name="binding_model_id" ref="point_of_sale.model_pos_session" />
        <field name="binding_type">report</field>
    </record>

    <!-- Template principal del reporte PDF -->
    <template id="report_shift_balance_document">
        <t t-call="web.html_container">
            <t t-call="asi_pos_reports.report_blank_layout">
                <div class="page" style="font-size: 11pt;">
                    <t t-foreach="docs" t-as="doc">
                        <t t-set="shift_data" t-value="doc._get_shift_balance_data()" />

                        <div style="text-align: center; margin-bottom: 20px;">
                            <h3 style="margin: 0 0 10px 0; font-weight: 600;">Balance de Turno</h3>
                            <div style="font-size: 10pt; color: #666;">
                                <div>
                                    <t t-esc="shift_data['date']" />
                                </div>
                            </div>
                        </div>

                        <div style="margin-bottom: 15px; font-size: 10pt;">
                            <div>
                                <strong>Usuario:</strong>
                                <t t-esc="shift_data['user_name']" />
                            </div>
                            <div>
                                <strong>Sesión:</strong>
                                <t t-esc="shift_data['session_name']" />
                            </div>
                            <hr style="margin: 10px 0; border-top: 1px solid #ddd;" />
                            <!-- Sección actualizada con Empresa, POS, Teléfono y valores alineados
                            a la derecha -->
                            <table style="width: 100%; font-size: 10pt;">
                                <tr>
                                    <td style="width: 30%;">
                                        <strong>Empresa:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['empresa_name']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Dirección:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['company_address']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Teléfono:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['company_phone']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Desde:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['start_date']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Hasta:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['end_date']" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Entidad:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['company_name']" />
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <hr style="margin: 15px 0; border-top: 2px solid #333;" />

                        <!-- Sección de Balance -->
                        <div style="margin-bottom: 15px;">
                            <table style="width: 100%; font-size: 10pt;">
                                <tr>
                                    <td>
                                        <strong>Inicio:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['opening_balance']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Efectivo:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['cash_amount']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Transferencias:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['other_income']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Gastos:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['expenses']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                                <tr style="font-weight: 600; background: #f5f5f5;">
                                    <td>
                                        <strong>Balance:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['balance']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <hr style="margin: 15px 0; border-top: 1px solid #ddd;" />

                        <!-- Sección de Pagos -->
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600; margin-bottom: 5px;">Pagos:</div>
                            <table style="width: 100%; font-size: 10pt;">
                                <t t-foreach="shift_data['payment_methods']" t-as="payment">
                                    <tr>
                                        <td>
                                            <t t-esc="payment['name']" />
                                        </td>
                                        <td style="text-align: right;">
                                            <t t-esc="payment['amount']"
                                                t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                        </td>
                                    </tr>
                                </t>
                            </table>
                        </div>

                        <hr style="margin: 15px 0; border-top: 1px solid #ddd;" />

                        <!-- Sección de Deudas, Servicio, Descuentos, Devoluciones -->
                        <div style="margin-bottom: 15px;">
                            <table style="width: 100%; font-size: 10pt;">
                                <tr>
                                    <td>
                                        <strong>Deudas:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['debts']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Servicio:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['service']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Descuento:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['discount']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Devoluciones:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['returns']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <hr style="margin: 15px 0; border-top: 1px solid #ddd;" />

                        <!-- Sección de Gastos -->
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600; margin-bottom: 5px;">Gastos:</div>
                            <table style="width: 100%; font-size: 10pt;">
                                <tr>
                                    <td>
                                        <strong>Retiro al cerrar:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['cash_amount']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <hr style="margin: 15px 0; border-top: 1px solid #ddd;" />

                        <!-- Balance Final -->
                        <div style="margin-bottom: 15px;">
                            <table style="width: 100%; font-size: 10pt;">
                                <tr>
                                    <td>
                                        <strong>Balance:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['balance']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Retiro:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['cash_amount']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Final:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['final_balance']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Restante:</strong>
                                    </td>
                                    <td style="text-align: right;">
                                        <t t-esc="shift_data['remaining']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <hr style="margin: 15px 0; border-top: 2px solid #333;" />

                        <!-- Total -->
                        <div style="text-align: right; font-size: 12pt; font-weight: 600;"> TOTAL: <t
                                t-esc="shift_data['total']"
                                t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                        </div>
                    </t>
                </div>
            </t>
        </t>
    </template>

    <!-- Template para previsualización de ticket -->
    <template id="report_shift_balance_ticket_preview">
        <t t-call="web.html_container">
            <t t-call="asi_pos_reports.report_blank_layout">
                <div class="page">
                    <t t-foreach="docs" t-as="doc">
                        <t t-set="shift_data" t-value="doc._get_shift_balance_data()" />

                        <div
                            style="max-width: 300px; margin: 0 auto; font-family: 'Courier New', monospace; border: 2px dashed #ccc; padding: 20px; background-color: #f9f9f9;">
                            <div style="font-weight: bold; margin-bottom: 5px; text-align: center;">Balance
                                de turno</div>
                            <br></br>
                            <div style="text-align: left; font-size: 12px;">
                                <div style="margin: 2px 0;">
                                    <t t-esc="shift_data['date']" />
                                </div>
                                <div style="margin: 2px 0;">Usuario: <t
                                        t-esc="shift_data['user_name']" /></div>
                                <div style="margin: 2px 0;">Sesión: <t
                                        t-esc="shift_data['session_name']" /></div>
                                <div style="margin: 5px 0;">============================</div>
                                <!-- Sección actualizada con Empresa, POS (Entidad) y Teléfono con
                                valores alineados a la derecha -->
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell; width: 40%;">Empresa:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['empresa_name']" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell; width: 40%;">Dirección:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['company_address']" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell; width: 40%;">Teléfono:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['company_phone']" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell; width: 40%;">Desde:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['start_date']" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell; width: 40%;">Hasta:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['end_date']" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell; width: 40%;">Entidad:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['company_name']" />
                                    </div>
                                </div>
                                <div style="margin: 5px 0;">============================</div>
                            </div>

                            <!-- Balance -->
                            <div style="font-size: 12px;">
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Inicio:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['opening_balance']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Efectivo:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['cash_amount']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Transferencias:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['other_income']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Gastos:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['expenses']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                                <div
                                    style="display: table; width: 100%; margin: 2px 0; font-weight: bold;">
                                    <div style="display: table-cell;">Balance:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['balance']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                            </div>

                            <div style="margin: 5px 0;">============================</div>

                            <!-- Pagos -->
                            <div style="font-size: 12px;">
                                <div style="font-weight: bold; margin: 5px 0;">Pagos:</div>
                                <t t-foreach="shift_data['payment_methods']" t-as="payment">
                                    <div style="display: table; width: 100%; margin: 2px 0;">
                                        <div style="display: table-cell;">
                                            <t t-esc="payment['name']" />
                                        </div>
                                        <div style="display: table-cell; text-align: right;">
                                            <t t-esc="payment['amount']"
                                                t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                        </div>
                                    </div>
                                </t>
                            </div>

                            <div style="margin: 5px 0;">============================</div>

                            <!-- Deudas, Servicio, Descuento, Devoluciones -->
                            <div style="font-size: 12px;">
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Deudas:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['debts']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Servicio:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['service']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Descuento:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['discount']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Devoluciones:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['returns']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                            </div>

                            <div style="margin: 5px 0;">============================</div>

                            <!-- Gastos -->
                            <div style="font-size: 12px;">
                                <div style="font-weight: bold; margin: 5px 0;">Gastos:</div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Retiro al cerrar:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['cash_amount']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                            </div>

                            <div style="margin: 5px 0;">============================</div>

                            <!-- Balance Final -->
                            <div style="font-size: 12px;">
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Balance:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['balance']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Retiro:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['cash_amount']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Final:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['final_balance']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                                <div style="display: table; width: 100%; margin: 2px 0;">
                                    <div style="display: table-cell;">Restante:</div>
                                    <div style="display: table-cell; text-align: right;">
                                        <t t-esc="shift_data['remaining']"
                                            t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                                    </div>
                                </div>
                            </div>

                            <div style="margin: 5px 0;">============================</div>

                            <!-- Total -->
                            <div
                                style="text-align: center; font-weight: bold; font-size: 14px; margin: 10px 0;">
                                TOTAL: <t t-esc="shift_data['total']"
                                    t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}" />
                            </div>
                        </div>
                    </t>
                </div>
            </t>
        </t>
    </template>

    <!-- Template para ticket de impresora -->
    <template id="report_shift_balance_ticket_document">
        <t t-call="asi_pos_reports.report_ticket_thermal_layout">
            <t t-foreach="docs" t-as="doc">
                <div class="ticket-content" style="font-size:11px">
                    <div class="ticket-center">
                        <p class="ticket-line" style="font-size:12px">
                            <strong>BALANCE DE TURNO</strong>
                        </p>
                        <p class="ticket-line">============================</p>
                    </div>

                    <div class="ticket-left">
                        <p class="ticket-line">Fecha: <t t-esc="doc.start_at.strftime('%d/%m/%Y')" /></p>
                        <p class="ticket-line">Usuario: <t t-esc="doc.user_id.name" /></p>
                        <p class="ticket-line">Sesion: <t t-esc="doc.name" /></p>
                        <p class="ticket-line">============================</p>
                    </div>

                    <t t-set="shift_data" t-value="doc._get_shift_balance_data()" />

                    <div class="ticket-left">
                        <p class="ticket-line">Empresa: <t t-esc="shift_data['empresa_name']" /></p>
                        <p class="ticket-line">Entidad: <t t-esc="shift_data['company_name']" /></p>
                        <p class="ticket-line">Desde: <t t-esc="shift_data['start_date']" /></p>
                        <p class="ticket-line">Hasta: <t t-esc="shift_data['end_date']" /></p>
                        <p class="ticket-line">============================</p>
                    </div>

                    <div class="ticket-left">
                        <p class="ticket-line">Inicio: $<t
                                t-esc="'{0:.2f}'.format(shift_data['opening_balance'])" /></p>
                        <p class="ticket-line">Efectivo: $<t
                                t-esc="'{0:.2f}'.format(shift_data['cash_amount'])" /></p>
                        <p class="ticket-line">Transferencias: $<t
                                t-esc="'{0:.2f}'.format(shift_data['other_income'])" /></p>
                        <p class="ticket-line">Gastos: $<t
                                t-esc="'{0:.2f}'.format(shift_data['expenses'])" /></p>
                        <p class="ticket-line">
                            <strong>Balance: $<t t-esc="'{0:.2f}'.format(shift_data['balance'])" /></strong>
                        </p>
                        <p class="ticket-line">============================</p>
                    </div>

                    <div class="ticket-left">
                        <p class="ticket-line">
                            <strong>PAGOS:</strong>
                        </p>
                        <t t-foreach="shift_data['payment_methods']" t-as="payment">
                            <p class="ticket-line"><t t-esc="payment['name']" />: $<t
                                    t-esc="'{0:.2f}'.format(payment['amount'])" /></p>
                        </t>
                        <p class="ticket-line">============================</p>
                    </div>

                    <div class="ticket-left">
                        <p class="ticket-line">Deudas: $<t
                                t-esc="'{0:.2f}'.format(shift_data['debts'])" /></p>
                        <p class="ticket-line">Servicio: $<t
                                t-esc="'{0:.2f}'.format(shift_data['service'])" /></p>
                        <p class="ticket-line">Descuento: $<t
                                t-esc="'{0:.2f}'.format(shift_data['discount'])" /></p>
                        <p class="ticket-line">Devoluciones: $<t
                                t-esc="'{0:.2f}'.format(shift_data['returns'])" /></p>
                        <p class="ticket-line">============================</p>
                    </div>

                    <div class="ticket-left">
                        <p class="ticket-line">Balance: $<t
                                t-esc="'{0:.2f}'.format(shift_data['balance'])" /></p>
                        <p class="ticket-line">Retiro: $<t
                                t-esc="'{0:.2f}'.format(shift_data['cash_amount'])" /></p>
                        <p class="ticket-line">Final: $<t
                                t-esc="'{0:.2f}'.format(shift_data['final_balance'])" /></p>
                        <p class="ticket-line">Restante: $<t
                                t-esc="'{0:.2f}'.format(shift_data['remaining'])" /></p>
                        <p class="ticket-line">============================</p>
                    </div>

                    <div class="ticket-center">
                        <p class="ticket-line">
                            <strong>TOTAL: $<t t-esc="'{0:.2f}'.format(shift_data['total'])" /></strong>
                        </p>
                        <p class="ticket-line">============================</p>
                    </div>
                </div>
            </t>
        </t>
    </template>

    <!-- Reporte Ticket de Balance de Turno para impresora -->
    <record id="action_report_shift_balance_ticket" model="ir.actions.report">
        <field name="name">Ticket de Balance de Turno</field>
        <field name="model">pos.session</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">asi_pos_reports.report_shift_balance_ticket_document</field>
        <field name="report_file">asi_pos_reports.report_shift_balance_ticket_document</field>
        <field name="binding_model_id" ref="point_of_sale.model_pos_session" />
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="asi_pos_reports.paperformat_thermal_ticket" />
    </record>

    <!-- Reporte para previsualización de ticket -->
    <record id="action_report_shift_balance_ticket_preview" model="ir.actions.report">
        <field name="name">Previsualización Ticket - Balance de Turno</field>
        <field name="model">pos.session</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">asi_pos_reports.report_shift_balance_ticket_preview</field>
        <field name="report_file">asi_pos_reports.report_shift_balance_ticket_preview</field>
        <field name="binding_model_id" ref="point_of_sale.model_pos_session" />
        <field name="binding_type">report</field>
    </record>
</odoo>