<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_pdf_selection_wizard_form" model="ir.ui.view">
        <field name="name">pdf.selection.wizard.form</field>
        <field name="model">pdf.selection.wizard</field>
        <field name="arch" type="xml">
            <form string="Seleccionar Documentos PDF">
                <field name="selection_type" invisible="1" />
                <field name="local_count" invisible="1" />
                <field name="selected_count" invisible="1" />
                <field name="parent_folder_id" invisible="1" />

                <!-- Selección de Documentos Locales -->
                <div attrs="{'invisible': [('selection_type', '!=', 'local')]}">
                    <div class="alert alert-info" role="alert">
                        <h4><i class="fa fa-upload" /> Documentos Locales</h4>
                        <p>Suba los documentos PDF desde su computadora que serán firmados.</p>
                    </div>

                    <group string="Documentos PDF" col="1">
                        <field name="local_document_ids" nolabel="1">
                            <tree editable="bottom" create="true" delete="true">
                                <field name="name" required="1" />
                                <field name="pdf_content" widget="binary" filename="pdf_filename"
                                    required="1" />
                                <field name="pdf_filename" invisible="1" />
                                <field name="file_size" readonly="1" />
                                <field name="is_valid_pdf" readonly="1" widget="boolean_toggle" />
                            </tree>
                        </field>
                    </group>

                    <div class="alert alert-warning" role="alert"
                        attrs="{'invisible': [('local_count', '>', 0)]}">
                        <p><i class="fa fa-info-circle" /> No hay documentos agregados. Use el botón
                            "Agregar línea" para subir archivos PDF.</p>
                    </div>

                    <footer>
                        <button name="action_confirm_selection" string="Confirmar Selección"
                            type="object" class="btn-primary"
                            attrs="{'invisible': [('local_count', '=', 0)]}" />
                    </footer>
                </div>

                <!-- Selección de Documentos de Alfresco -->
                <div attrs="{'invisible': [('selection_type', '!=', 'alfresco')]}">
                    <div class="alert alert-info" role="alert">
                        <h4><i class="fa fa-cloud" /> Documentos de Alfresco</h4>
                        <p>Navegue por las carpetas de Alfresco y seleccione los archivos PDF para
                            firmar.</p>
                    </div>

                    <!-- Navegación de carpetas -->
                    <group string="Navegación" col="1">
                        <div class="row">
                            <div class="col-8">
                                <strong>Ruta actual:</strong>
                                <field name="folder_path" readonly="1" nolabel="1" />
                            </div>
                            <div class="col-4 text-right">
                                <button name="action_go_to_root" string="Ir a Raíz" type="object"
                                    class="btn-sm btn-secondary" icon="fa-home" />
                                <button name="action_go_to_parent" string="Subir" type="object"
                                    class="btn-sm btn-secondary" icon="fa-level-up"
                                    attrs="{'invisible': [('parent_folder_id', '=', False)]}" />
                            </div>
                        </div>
                    </group>

                    <!-- Subcarpetas -->
                    <group string="Carpetas" col="1"
                        attrs="{'invisible': [('child_folder_ids', '=', [])]}">
                        <field name="child_folder_ids" nolabel="1" readonly="1">
                            <tree create="false" edit="false" delete="false">
                                <field name="name" />
                                <field name="subfolder_count" />
                                <field name="file_count" />
                                <button name="action_navigate_to_folder_wizard" type="object"
                                    string="Abrir" class="btn-sm btn-primary" icon="fa-folder-open"
                                    context="{'wizard_id': parent.id}" />
                            </tree>
                        </field>
                    </group>

                    <!-- Archivos PDF disponibles -->
                    <group string="Archivos PDF Disponibles" col="1">
                        <field name="alfresco_file_ids" nolabel="1" readonly="1"
                            attrs="{'invisible': [('alfresco_file_ids', '=', [])]}">
                            <tree create="false" edit="false" delete="false" multi_edit="1">
                                <field name="name" />
                                <field name="file_size_human" />
                                <field name="modified_at" />
                                <button name="action_select_file" type="object" string="Seleccionar"
                                    class="btn-sm btn-success" icon="fa-plus" />
                            </tree>
                        </field>

                        <div class="alert alert-info" role="alert"
                            attrs="{'invisible': [('alfresco_file_ids', '!=', [])]}">
                            <p><i class="fa fa-info-circle" /> No hay archivos PDF en esta carpeta.</p>
                        </div>
                    </group>

                    <!-- Archivos seleccionados -->
                    <group string="Archivos Seleccionados para Firma" col="1">
                        <field name="selected_alfresco_ids" nolabel="1"
                            domain="[('id', 'in', alfresco_file_ids)]"
                            attrs="{'invisible': [('selected_alfresco_ids', '=', [])]}">
                            <tree create="false" edit="false" delete="true">
                                <field name="name" />
                                <field name="folder_id" />
                                <field name="file_size_human" />
                                <button name="action_remove_file" type="object" string="Quitar"
                                    class="btn-sm btn-danger" icon="fa-minus" />
                            </tree>
                        </field>

                        <div class="alert alert-warning" role="alert"
                            attrs="{'invisible': [('selected_count', '>', 0)]}">
                            <p><i class="fa fa-info-circle" /> No hay archivos seleccionados.
                                Seleccione archivos de la lista superior.</p>
                        </div>
                    </group>

                    <footer>
                        <button name="action_confirm_selection" string="Confirmar Selección"
                            type="object" class="btn-primary"
                            attrs="{'invisible': [('selected_count', '=', 0)]}" />
                    </footer>
                </div>
                <footer>
                    <button string="Cancelar" class="btn-secondary" special="cancel" />
                </footer>
            </form>
        </field>
    </record>

    <record id="action_pdf_selection_wizard" model="ir.actions.act_window">
        <field name="name">Seleccionar Documentos PDF</field>
        <field name="res_model">pdf.selection.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
</odoo>