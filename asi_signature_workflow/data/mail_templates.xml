<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Template para solicitud de firma -->
        <record id="mail_template_signature_request" model="mail.template">
            <field name="name">Solicitud de Firma Digital - Flujo de Trabajo</field>
            <field name="model_id" ref="model_signature_workflow"/>
            <field name="subject">üñäÔ∏è Solicitud de Firma Digital: ${object.name}</field>
            <field name="email_from">${(object.creator_id.email or user.email)|safe}</field>
            <field name="email_to">${object.target_user_id.email}</field>
            <field name="body_html" type="html">
<div style="margin: 0px; padding: 0px; font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFFFFF;">
    <table border="0" cellpadding="0" cellspacing="0" style="padding-top: 16px; background-color: #FFFFFF; font-family:'Lucida Grande',Ubuntu,Arial,Verdana,sans-serif; color: rgb(34, 34, 34); width: 100%; border-collapse:separate;">
        <tr>
            <td align="center">
                <table border="0" cellpadding="0" cellspacing="0" width="590" style="padding: 16px; background-color: #FFFFFF; color: rgb(34, 34, 34); border-collapse:separate;">
                    <tbody>
                        <!-- Header -->
                        <tr>
                            <td align="center" style="min-height: 50px; padding-bottom: 20px;">
                                <div style="padding: 20px; background-color: #875A7B; border-radius: 10px;">
                                    <h1 style="color: #FFFFFF; margin: 0; font-size: 24px;">
                                        üñäÔ∏è Solicitud de Firma Digital
                                    </h1>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Content -->
                        <tr>
                            <td style="padding-bottom: 20px;">
                                <p style="margin: 0 0 10px 0; font-size: 14px;">
                                    Estimado/a <strong>${object.target_user_id.name}</strong>,
                                </p>
                                
                                <p style="margin: 0 0 15px 0; font-size: 14px;">
                                    <strong>${object.creator_id.name}</strong> le ha enviado un flujo de trabajo de firma digital que requiere su atenci√≥n.
                                </p>
                                
                                <!-- Workflow Details -->
                                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                    <h3 style="margin: 0 0 10px 0; color: #875A7B; font-size: 16px;">
                                        üìã Detalles del Flujo
                                    </h3>
                                    <table style="width: 100%; font-size: 14px;">
                                        <tr>
                                            <td style="padding: 5px 0; width: 30%; font-weight: bold;">Nombre del Flujo:</td>
                                            <td style="padding: 5px 0;">${object.name}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 5px 0; font-weight: bold;">Rol de Firma:</td>
                                            <td style="padding: 5px 0;">${object.signature_role_id.name}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 5px 0; font-weight: bold;">Cantidad de Documentos:</td>
                                            <td style="padding: 5px 0;">${object.document_count} archivo(s) PDF</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 5px 0; font-weight: bold;">Origen:</td>
                                            <td style="padding: 5px 0;">
                                                % if object.document_source == 'alfresco':
                                                    üìÅ Documentos de Alfresco
                                                % else:
                                                    üíª Documentos Locales
                                                % endif
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 5px 0; font-weight: bold;">Fecha de Env√≠o:</td>
                                            <td style="padding: 5px 0;">${format_datetime(object.sent_date, tz=user.tz, dt_format='medium')}</td>
                                        </tr>
                                    </table>
                                </div>
                                
                                <!-- Notes if any -->
                                % if object.notes:
                                <div style="background-color: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #2196f3;">
                                    <h4 style="margin: 0 0 10px 0; color: #1976d2; font-size: 14px;">
                                        üí¨ Notas del Creador:
                                    </h4>
                                    <p style="margin: 0; font-size: 14px; font-style: italic;">
                                        ${object.notes}
                                    </p>
                                </div>
                                % endif
                                
                                <!-- Documents List -->
                                <div style="background-color: #fff3e0; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                    <h4 style="margin: 0 0 10px 0; color: #f57c00; font-size: 14px;">
                                        üìÑ Documentos a Firmar:
                                    </h4>
                                    <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                                        % for doc in object.document_ids:
                                        <li style="margin: 5px 0;">${doc.name}</li>
                                        % endfor
                                    </ul>
                                </div>
                                
                                <!-- Action Button -->
                                <div style="text-align: center; margin: 25px 0;">
                                    <a href="${ctx.get('base_url', '')}/web#id=${object.id}&amp;model=signature.workflow&amp;view_type=form" 
                                       style="background-color: #875A7B; color: white; padding: 12px 25px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block; font-size: 16px;">
                                        üñäÔ∏è FIRMAR DOCUMENTOS AHORA
                                    </a>
                                </div>
                                
                                <p style="margin: 15px 0 0 0; font-size: 13px; color: #666;">
                                    Para firmar los documentos, haga clic en el bot√≥n anterior o acceda a su cuenta de Odoo y busque el flujo en el men√∫ "Firma Digital".
                                </p>
                            </td>
                        </tr>
                        
                        <!-- Footer -->
                        <tr>
                            <td style="text-align: center; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                                <p style="margin: 0; font-size: 12px; color: #999;">
                                    Este es un mensaje autom√°tico del sistema de Firma Digital.<br/>
                                    Por favor, no responda a este correo.
                                </p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    </table>
</div>
            </field>
        </record>

        <!-- Template para notificaci√≥n de finalizaci√≥n -->
        <record id="mail_template_signature_completed" model="mail.template">
            <field name="name">Documentos Firmados - Flujo Completado</field>
            <field name="model_id" ref="model_signature_workflow"/>
            <field name="subject">‚úÖ Documentos Firmados: ${object.name}</field>
            <field name="email_from">${(user.email)|safe}</field>
            <field name="email_to">${object.creator_id.email}</field>
            <field name="body_html" type="html">
<div style="margin: 0px; padding: 0px; font-family: 'Lucida Grande', Ubuntu, Arial, Verdana, sans-serif; font-size: 12px; color: rgb(34, 34, 34); background-color: #FFFFFF;">
    <table border="0" cellpadding="0" cellspacing="0" style="padding-top: 16px; background-color: #FFFFFF; font-family:'Lucida Grande',Ubuntu,Arial,Verdana,sans-serif; color: rgb(34, 34, 34); width: 100%; border-collapse:separate;">
        <tr>
            <td align="center">
                <table border="0" cellpadding="0" cellspacing="0" width="590" style="padding: 16px; background-color: #FFFFFF; color: rgb(34, 34, 34); border-collapse:separate;">
                    <tbody>
                        <!-- Header -->
                        <tr>
                            <td align="center" style="min-height: 50px; padding-bottom: 20px;">
                                <div style="padding: 20px; background-color: #4caf50; border-radius: 10px;">
                                    <h1 style="color: #FFFFFF; margin: 0; font-size: 24px;">
                                        ‚úÖ ¬°Documentos Firmados!
                                    </h1>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Content -->
                        <tr>
                            <td style="padding-bottom: 20px;">
                                <p style="margin: 0 0 10px 0; font-size: 14px;">
                                    Estimado/a <strong>${object.creator_id.name}</strong>,
                                </p>
                                
                                <p style="margin: 0 0 15px 0; font-size: 14px;">
                                    Le informamos que <strong>${object.target_user_id.name}</strong> ha completado exitosamente la firma de los documentos del flujo de trabajo.
                                </p>
                                
                                <!-- Workflow Details -->
                                <div style="background-color: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #4caf50;">
                                    <h3 style="margin: 0 0 10px 0; color: #2e7d32; font-size: 16px;">
                                        üìã Resumen del Flujo Completado
                                    </h3>
                                    <table style="width: 100%; font-size: 14px;">
                                        <tr>
                                            <td style="padding: 5px 0; width: 30%; font-weight: bold;">Nombre del Flujo:</td>
                                            <td style="padding: 5px 0;">${object.name}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 5px 0; font-weight: bold;">Firmado por:</td>
                                            <td style="padding: 5px 0;">${object.target_user_id.name}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 5px 0; font-weight: bold;">Rol de Firma:</td>
                                            <td style="padding: 5px 0;">${object.signature_role_id.name}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 5px 0; font-weight: bold;">Documentos Firmados:</td>
                                            <td style="padding: 5px 0;">${object.document_count} archivo(s) PDF</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 5px 0; font-weight: bold;">Fecha de Finalizaci√≥n:</td>
                                            <td style="padding: 5px 0;">${format_datetime(object.completed_date, tz=user.tz, dt_format='medium')}</td>
                                        </tr>
                                    </table>
                                </div>
                                
                                <!-- Signed Documents List -->
                                <div style="background-color: #f3e5f5; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                    <h4 style="margin: 0 0 10px 0; color: #7b1fa2; font-size: 14px;">
                                        üìÑ Documentos Firmados Disponibles:
                                    </h4>
                                    <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                                        % for doc in object.document_ids.filtered('is_signed'):
                                        <li style="margin: 8px 0;">
                                            <strong>${doc.name}</strong>
                                            % if doc.download_url:
                                            <br/>
                                            <a href="${ctx.get('base_url', '')}${doc.download_url}" 
                                               style="color: #7b1fa2; text-decoration: none; font-size: 12px;">
                                                üîó ${ctx.get('base_url', '')}${doc.download_url}
                                            </a>
                                            % endif
                                        </li>
                                        % endfor
                                    </ul>
                                </div>
                                
                                <!-- Download All Button -->
                                <div style="text-align: center; margin: 25px 0; padding: 20px; background-color: #fff8e1; border-radius: 8px;">
                                    <h3 style="margin: 0 0 15px 0; color: #f57c00; font-size: 18px;">
                                        üìÑ DESCARGAR DOCUMENTOS FIRMADOS
                                    </h3>
                                    <a href="${ctx.get('base_url', '')}/signature_workflow/download_signed/${object.id}" 
                                       style="background-color: #ff9800; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px; font-weight: bold; display: inline-block; font-size: 18px; margin: 10px;">
                                        üì• DESCARGAR AHORA!
                                    </a>
                                    <!-- Updated description to clarify individual downloads -->
                                    <p style="margin: 10px 0 0 0; font-size: 12px; color: #666;">
                                        Haga clic para acceder a la p√°gina de descarga donde podr√° descargar cada documento firmado individualmente
                                    </p>
                                </div>
                                
                                <!-- Access Instructions -->
                                <div style="background-color: #e1f5fe; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                    <h4 style="margin: 0 0 10px 0; color: #0277bd; font-size: 14px;">
                                        ‚ÑπÔ∏è Acceso a los Documentos:
                                    </h4>
                                    <p style="margin: 0; font-size: 14px;">
                                        % if object.document_source == 'alfresco':
                                        Los documentos firmados han sido actualizados como nuevas versiones en Alfresco en sus ubicaciones originales.
                                        % else:
                                        Los documentos firmados han sido subidos a su carpeta compartida en Alfresco: <strong>Documentos_Firmados_${object.creator_id.login}</strong>
                                        % endif
                                    </p>
                                    <p style="margin: 10px 0 0 0; font-size: 13px;">
                                        Tambi√©n puede acceder al flujo completo desde: 
                                        <a href="${ctx.get('base_url', '')}/web#id=${object.id}&amp;model=signature.workflow&amp;view_type=form" 
                                           style="color: #0277bd;">Ver Flujo en Odoo</a>
                                    </p>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Footer -->
                        <tr>
                            <td style="text-align: center; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                                <p style="margin: 0; font-size: 12px; color: #999;">
                                    Este es un mensaje autom√°tico del sistema de Firma Digital.<br/>
                                    Los documentos firmados est√°n disponibles para descarga inmediata.
                                </p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    </table>
</div>
            </field>
        </record>
    </data>
</odoo>
