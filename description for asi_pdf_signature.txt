 
 
==== Archivo: C:\Users\javier\Documents\GitHub\addons_antasi\asi_pdf_signature\data\signature_tags.xml ==== 
 
<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="signature_tag_aprobado" model="document.signature.tag">
            <field name="name">Aprobado por</field>
        </record>
        <record id="signature_tag_autorizado" model="document.signature.tag">
            <field name="name">Autorizado por</field>
        </record>
        <record id="signature_tag_elaborado" model="document.signature.tag">
            <field name="name">Elaborado por</field>
        </record>
        <record id="signature_tag_solicitado" model="document.signature.tag">
            <field name="name">Solicitado por</field>
        </record>
    </data>
</odoo> 
 
==== Archivo: C:\Users\javier\Documents\GitHub\addons_antasi\asi_pdf_signature\security\ir.model.access.csv ==== 
 
id,name,model_id:id,group_id:id,perm_read,perm_write,perm_create,perm_unlink
access_firma_documento_wizard,access.firma.documento.wizard,model_firma_documento_wizard,base.group_user,1,1,1,1
access_document_signature_tag_user,document.signature.tag.user,model_document_signature_tag,,1,0,0,0
access_document_signature_tag_admin,document.signature.tag.admin,model_document_signature_tag,base.group_system,1,1,1,1
 
 
==== Archivo: C:\Users\javier\Documents\GitHub\addons_antasi\asi_pdf_signature\security\security.xml ==== 
 
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!-- Grupo de seguridad para firma digital -->
        <record id="group_firma_digital_user" model="res.groups">
            <field name="name">Firma Digital / Usuario</field>
            <field name="category_id" ref="base.module_category_hidden"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>
    </data>
</odoo>
 
 
==== Archivo: C:\Users\javier\Documents\GitHub\addons_antasi\asi_pdf_signature\static\src\css\firma_digital.css ==== 
 
/* Estilos específicos para el módulo de firma digital */

.o_form_view .o_firma_digital_header {
  background-color: #f8f9fa;
  padding: 8px 16px;
  margin-bottom: 16px;
  border-radius: 4px;
}

.o_form_view .o_firma_digital_footer {
  margin-top: 16px;
  text-align: center;
}

/* Estilos para el botón de mostrar/ocultar contraseña */
.o_firma_digital_password_toggle {
  cursor: pointer;
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
}

/* Estilos para el campo de contraseña */
.o_firma_digital_password_field {
  position: relative;
}

/* Estilos para el campo de PDF */
.o_firma_digital_pdf_field {
  margin-bottom: 16px;
}

/* Estilos para el botón de firmar */
.o_firma_digital_sign_button {
  background-color: #00a09d;
  color: white;
}

.o_firma_digital_sign_button:hover {
  background-color: #007d7a;
}

/* Estilos para la imagen de la firma */
.o_form_view .o_field_image.o_firma_digital_signature_image {
  max-width: 300px;
  max-height: 150px;
  border: 1px dashed #ccc;
  padding: 8px;
}
 
 
==== Archivo: C:\Users\javier\Documents\GitHub\addons_antasi\asi_pdf_signature\static\src\js\firma_digital.js ==== 
 
odoo.define("firma_digital.firma_digital", (require) => {
  var core = require("web.core")
  var FormView = require("web.FormView")
  var FormController = require("web.FormController")
  var FormRenderer = require("web.FormRenderer")
  var _t = core._t

  // Extender el renderizador del formulario para añadir funcionalidades específicas
  FormRenderer.include({
    _renderWidget: function (widget, node) {
      var $el = this._super.apply(this, arguments)

      // Añadir código personalizado para la vista del formulario de firma si es necesario
      if (this.state.model === "firma.documento.wizard") {
        // Código específico para la vista de firma de documentos
      }

      return $el
    },
  })

  // Extender el controlador del formulario para añadir funcionalidades específicas
  FormController.include({
    _onButtonClicked: function (event) {
      
      // Si se ha completado la acción de firma, verificar si debe descargarse automáticamente
      if (this.modelName === "firma.documento.wizard" && event.data.attrs.name === "action_firmar_documento") {
        // El resto se maneja normalmente
        return this._super.apply(this, arguments).then((action) => {
          // Verificar si debemos descargar el PDF automáticamente
          if (action && this.renderer.state.data.estado === "firmado" && this.renderer.state.context.descargar_pdf) {
            this._rpc({
              model: "firma.documento.wizard",
              method: "action_descargar_pdf",
              args: [this.renderer.state.res_id],
            }).then((result) => {
              if (result && result.type === "ir.actions.act_url") {
                window.location = result.url
              }
            })
          }
          return action
        })
      }

      return this._super.apply(this, arguments)
    },
  })
})
 
 
==== Archivo: C:\Users\javier\Documents\GitHub\addons_antasi\asi_pdf_signature\views\firma_digital_menu.xml ==== 
 
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Menú principal -->
    <menuitem id="menu_firma_digital_root" 
              name="Firma Digital" 
              web_icon="asi_pdf_signature,static/description/icon.png" 
              sequence="90"/>
    
    <!-- Submenú para firmar documentos -->
    <menuitem id="menu_firma_documento"
              name="Firmar Documento"
              parent="menu_firma_digital_root"
              action="asi_pdf_signature.action_firma_documento_wizard"
              sequence="10"/>
</odoo>
 
 
==== Archivo: C:\Users\javier\Documents\GitHub\addons_antasi\asi_pdf_signature\views\res_users_views.xml ==== 
 
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Añadir campos a las preferencias de usuario -->
    <record id="view_users_form_firma_digital" model="ir.ui.view">
        <field name="name">res.users.form.firma.digital</field>
        <field name="model">res.users</field>
        <field name="inherit_id" ref="base.view_users_form"/>
        <field name="arch" type="xml">
            <notebook position="inside">
                <page string="Firma Digital" name="firma_digital">
                    <group>
                        <field name="certificado_firma" filename="nombre_certificado" widget="binary"/>
                        <field name="nombre_certificado" invisible="1"/>
                        <field name="imagen_firma" widget="image" options="{'size': [300, 150]}"/>
                    </group>
                    <div class="alert alert-info" role="alert">
                        <p>Suba su certificado de firma digital (.p12) y la imagen de su firma para poder firmar documentos.</p>
                        <p>La contraseña del certificado se solicitará al momento de firmar cada documento.</p>
                    </div>
                </page>
            </notebook>
        </field>
    </record>

    <!-- Añadir campos a la preferencias del usuario actual -->
    <record id="view_users_form_preferences_firma_digital" model="ir.ui.view">
        <field name="name">res.users.preferences.firma.digital</field>
        <field name="model">res.users</field>
        <field name="inherit_id" ref="base.view_users_form_simple_modif"/>
        <field name="arch" type="xml">
            <group name="preferences" position="after">
                <group string="Firma Digital" name="firma_digital_preferencias">
                    <field name="certificado_firma" filename="nombre_certificado" widget="binary"/>
                    <field name="nombre_certificado" invisible="1"/>
                    <field name="imagen_firma" widget="image" options="{'size': [300, 150]}"/>
                </group>
                <div class="alert alert-info" role="alert">
                    <p>Suba su certificado de firma digital (.p12) y la imagen de su firma para poder firmar documentos.</p>
                    <p>La contraseña del certificado se solicitará al momento de firmar cada documento.</p>
                </div>
            </group>
        </field>
    </record>
</odoo>
 
 
==== Archivo: C:\Users\javier\Documents\GitHub\addons_antasi\asi_pdf_signature\wizards\firma_documento_views.xml ==== 
 
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_firma_documento_wizard_form" model="ir.ui.view">
        <field name="name">firma.documento.wizard.form</field>
        <field name="model">firma.documento.wizard</field>
        <field name="arch" type="xml">
            <form string="Firma Digital de Documentos">
                <field name="estado" invisible="1"/>
                <field name="pdf_firmado" invisible="1"/>
                
                <div attrs="{'invisible': [('estado', '!=', 'borrador')]}">
                    <div class="alert alert-info" role="alert">
                        <p>Seleccione un documento PDF para firmar digitalmente.</p>
                        <p>El documento firmado incluirá su firma digital y su imagen de firma en la última página del documento.</p>
                    </div>
                    <group>
                        <field name="signature_tag_id" widget="many2one_tag"/>
                        <field name="signature_location" widget="radio" />
                        </group>
                    <group>
                        <field name="pdf_documento" filename="nombre_documento" widget="binary" required="1"/>
                        <field name="nombre_documento" invisible="1"/>                    
                        <field name="contrasena_firma" password="True" required="1"/>
                    </group>
                    
                    <footer>
                        <button name="action_firmar_documento" string="Firmar" type="object" class="btn-primary" 
                                attrs="{'invisible': ['|', ('pdf_documento', '=', False), ('contrasena_firma', '=', False)]}"/>
                    </footer>
                </div>
                
                <div attrs="{'invisible': [('estado', '!=', 'firmado')]}">
                    <div class="alert alert-success" role="alert">
                        <p>¡El documento ha sido firmado exitosamente!</p>
                        <p>Puede descargarlo haciendo clic en el botón "Descargar PDF Firmado".</p>
                    </div>
                    
                    <footer>
                        <button name="action_descargar_pdf" string="Descargar PDF Firmado" type="object" class="btn-primary"/>
                        <button string="Cerrar" class="btn-secondary" special="cancel"/>
                    </footer>
                </div>
                
                <div attrs="{'invisible': [('estado', '!=', 'error')]}">
                    <div class="alert alert-danger" role="alert">
                        <p>Ha ocurrido un error durante el proceso de firma:</p>
                        <field name="mensaje_error" readonly="1"/>
                    </div>
                </div>
            </form>
        </field>
    </record>
    
    <record id="action_firma_documento_wizard" model="ir.actions.act_window">
        <field name="name">Firmar Documento</field>
        <field name="res_model">firma.documento.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_firma_documento_wizard_form"/>
        <field name="target">new</field>
    </record>
</odoo>
 
